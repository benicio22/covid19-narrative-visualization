<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Narrative Visualization</title>
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <style>
        rect { fill: mediumaquamarine; stroke: black; }
        p.stats { position: absolute; left: 5px; top: 250px; }
        select { position: absolute; left: 5px; top: 290px; }
        div.slide { position: absolute; left: 5px; top: 220px; }
        .scene { font-size: 18px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>COVID-19 Impact Visualization</h1>
    <hr>
    <div class="scene" id="scene-description"></div>
    <div class="slide">
        <button type="button" id="prevScene">Prev</button>
        <button type="button" id="nextScene">Next</button>
    </div>
    <svg width="10000" height="1500"></svg>
    <script>
        let scenes = [
            {
                title: "Scene 1: Number of Cases",
                description: "The CDC gov website definitively stated on May 1st, 2024, that hospitals are no longer required to report any data related to the admission of patients with the Coronavirus (COVID-19) to the Department of Health and Human Services (HHS) through the CDC's National Healthcare Safety Network (NHSN). However, the CDC demands that hospitals report any data related to the pandemic voluntarily. The global impact of the pandemic is undeniable. Since 2020, it has had a significant impact on health, economies, and the population's daily lives. The number of cases skyrocketed, especially during 2020 and 2021. This led to a surge in severe cases and mortality rates. However, the widespread vaccination campaigns have undoubtedly reduced these rates. Despite these advances, the world still faces the challenge of the ongoing circulation of the virus, with periodic surges attributed to new variants. Nevertheless, the world's health systems remain vigilant and committed to monitoring and maintaining efforts to manage the virus while addressing other public health needs.",
                dataKey: 'cases'
            },
            {
                title: "Scene 2: Deaths",
                description: "The number of deaths is also a key factor. We must consider other metrics, such as the number of deaths. The number of deaths reached its highest point in January 2021, before the vaccination program was implemented. A second peak occurred one year later, in January 2022, due to the emergence of the Delta variant. Knowing the number of deaths from COIVD-19 is essential for understanding the severity of the pandemic and its impact on public health. This information is essential for understanding the effectiveness of interventions, allocating medical resources, and prioritizing vaccination efforts. It is essential that accurate death numbers inform health guidelines, ensuring they are based on the most severe outcomes.",
                dataKey: 'deaths'
            },
            {
                title: "Scene 3: Mortality Rate",
                description: "The mortality rate is the proportion of deaths among confirmed cases of COIVD-19. It provides a comprehensive and precise understanding of the virus's lethality and public health impact. The mortality rate is the only way to compare the severity of the pandemic across different regions, periods, and population groups. The number of deaths does not provide this information. The graphic clearly shows that the mortality rate reached its highest point in February 2020, at the start of the pandemic. At that time, there were no preventive measures in place, so the authorities had no choice but to put entire countries under lockdown. A few months later, the mortality rate was drastically reduced and remained relatively low until early 2021. This was caused by increased gatherings due to the holidays and the spread of the Delta variant, which is known to be more deadly than the previous variants. Another peak occurred around March 2022 due to several states relaxing pandemic preventive measures such as the mandatory use of face masks.",
                dataKey: 'mortality'
            }
        ];
        let currentSceneIndex = 0;

        async function init() {
            let data = await d3.csv("covid_data.csv"); // Ensure your CSV contains the necessary columns for Cases, Deaths, and MortalityRate
            updateScene();
            
            d3.select("#nextScene").on("click", function() {
                if (currentSceneIndex < scenes.length - 1) {
                    currentSceneIndex++;
                    updateScene();
                }
            });
            
            d3.select("#prevScene").on("click", function() {
                if (currentSceneIndex > 0) {
                    currentSceneIndex--;
                    updateScene();
                }
            });
        }

        function updateScene() {
            d3.select("#scene-description").html(`
                <h2>${scenes[currentSceneIndex].title}</h2>
                <p>${scenes[currentSceneIndex].description}</p>
            `);

            // Clear previous content
            d3.select('svg').selectAll("*").remove();

            // Render the current scene
            renderChart(scenes[currentSceneIndex].dataKey);
        }

        function renderChart(dataKey) {
            d3.csv("covid_data.csv").then(data => {
                var x = d3.scaleBand().rangeRound([0, 1000]).padding(0.1).domain(data.map(d => d.Date));
                var y = d3.scaleLinear().range([500, 0]).domain([0, d3.max(data, d => +d[dataKey])]);

                var svg = d3.select('svg').attr('width', 1000).attr('height', 600);

                svg.append('g')
                    .attr('transform', 'translate(50, 50)')
                    .selectAll('rect')
                    .data(data)
                    .enter()
                    .append('rect')
                    .attr('x', d => x(d.Date))
                    .attr('y', d => y(d[dataKey]))
                    .attr('width', x.bandwidth())
                    .attr('height', d => 500 - y(d[dataKey]))
                    .attr('fill', 'steelblue')
                    .append('title')
                    .text(d => `${dataKey}: ${d[dataKey]}`);

                svg.append('g')
                    .attr('transform', 'translate(50, 550)')
                    .call(d3.axisBottom(x));

                svg.append('g')
                    .attr('transform', 'translate(50, 50)')
                    .call(d3.axisLeft(y));
            });
        }

        init();
    </script>
</body>
</html>
